"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.removeInstrumentsSocket = removeInstrumentsSocket;
exports.getAndCheckXcodeVersion = getAndCheckXcodeVersion;
exports.prepareIosOpts = prepareIosOpts;
exports.appIsPackageOrBundle = appIsPackageOrBundle;
exports.getAndCheckIosSdkVersion = getAndCheckIosSdkVersion;
exports.detectUdid = detectUdid;
exports.parseLocalizableStrings = parseLocalizableStrings;
exports.setBundleIdFromApp = setBundleIdFromApp;
exports.shouldPrelaunchSimulator = shouldPrelaunchSimulator;
exports.setDeviceTypeInInfoPlist = setDeviceTypeInInfoPlist;
exports.getSimForDeviceString = getSimForDeviceString;
exports.unwrapEl = unwrapEl;
exports.clearLogs = clearLogs;
exports.rootDir = void 0;

require("source-map-support/register");

var _appiumSupport = require("appium-support");

var _appiumXcode = _interopRequireDefault(require("appium-xcode"));

var _appUtils = require("./app-utils");

var _logger = _interopRequireDefault(require("./logger"));

var _path = _interopRequireDefault(require("path"));

var _lodash = _interopRequireDefault(require("lodash"));

var _teen_process = require("teen_process");

var _safari = require("./commands/safari");

var _safariLauncher = require("./safari-launcher");

const rootDir = _path.default.resolve(__dirname, '..', '..');

exports.rootDir = rootDir;
const STRINGSDICT_RESOURCE = '.stringsdict';
const STRINGS_RESOURCE = '.strings';

async function prepareIosOpts(opts) {
  opts.backendRetries = 4;
  opts.withoutDelay = !opts.nativeInstrumentsLib;
  opts.reset = !opts.noReset;
  opts.initialOrientation = opts.deviceOrientation || opts.orientation || 'PORTRAIT';
  opts.useRobot = opts.robotPort > 0;
  opts.robotUrl = opts.useRobot ? `http://${opts.robotAddress}:${opts.robotPort}` : null;

  if (opts.locationServicesAuthorized && !opts.bundleId) {
    throw new Error('You must set the bundleId cap if using locationServicesEnabled');
  }

  opts.platformVersion = opts.platformVersion || (await _appiumXcode.default.getMaxIOSSDK());
  let pv = parseFloat(opts.platformVersion);

  if (pv < 8) {
    _logger.default.warn(`iOS version ${opts.platformVersion} support has been ` + `deprecated and will be removed in a future version of ` + `Appium.`);
  }

  opts.localizableStringsDir = opts.localizableStringsDir || 'en.lproj';
  opts.autoAcceptAlerts = _lodash.default.isNull(opts.autoAcceptAlerts) || _lodash.default.isUndefined(opts.autoAcceptAlerts) ? false : opts.autoAcceptAlerts;
  opts.autoDismissAlerts = _lodash.default.isNull(opts.autoDismissAlerts) || _lodash.default.isUndefined(opts.autoDismissAlerts) ? false : opts.autoDismissAlerts;

  if ((opts.browserName || '').toLowerCase() === 'safari' || (opts.app || '').toLowerCase() === 'safari' || (opts.bundleId || '').toLowerCase() === _safari.SAFARI_BUNDLE) {
    if (opts.udid) {
      opts.app = opts.app || _safariLauncher.SAFARI_LAUNCHER_APP_FILE;
      opts.bundleId = opts.bundleId || _safariLauncher.SAFARI_LAUNCHER_BUNDLE;
    } else {
      if (parseFloat(opts.platformVersion) <= 8) {
        opts.app = 'safari';
        opts.bundleId = null;
      } else {
        opts.app = null;
        opts.bundleId = _safari.SAFARI_BUNDLE;
      }
    }

    opts.safari = true;
  }
}

function appIsPackageOrBundle(app) {
  return /^([a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+)+$/.test(app);
}

async function removeInstrumentsSocket(sock) {
  _logger.default.debug('Removing any remaining instruments sockets');

  await _appiumSupport.fs.rimraf(sock);

  _logger.default.debug(`Cleaned up instruments socket ${sock}`);
}

async function getAndCheckXcodeVersion(caps) {
  let version;

  try {
    version = await _appiumXcode.default.getVersion(true);
  } catch (err) {
    _logger.default.debug(err);

    _logger.default.error(`Could not determine Xcode version: ${err.message}`);

    throw err;
  }

  let minorVersion = version.versionFloat;
  let pv = parseFloat(caps.platformVersion);

  if (minorVersion < 6.3 && !(minorVersion === 6.0 && pv === 8.0)) {
    _logger.default.warn(`Xcode version '${version.versionString}'. Support for Xcode ` + `${version.versionString} has been deprecated and will be removed ` + `in a future version. Please upgrade to version 6.3 or ` + `higher (or version 6.0.1 for iOS 8.0)`);
  }

  return version;
}

async function getAndCheckIosSdkVersion() {
  let versionNumber;

  try {
    versionNumber = await _appiumXcode.default.getMaxIOSSDK();
  } catch (err) {
    _logger.default.error('Could not determine iOS SDK version');

    throw err;
  }

  return versionNumber;
}

function getSimForDeviceString(dString, availDevices) {
  let matchedDevice = null;
  let matchedUdid = null;

  _lodash.default.each(availDevices, function (device) {
    if (device.indexOf(dString) !== -1) {
      matchedDevice = device;

      try {
        matchedUdid = /.+\[([^\]]+)\]/.exec(device)[1];
      } catch (e) {
        matchedUdid = null;
      }
    }
  });

  return [matchedDevice, matchedUdid];
}

async function detectUdid(caps) {
  if (caps.udid !== null && caps.udid === 'auto') {
    _logger.default.debug('Auto-detecting iOS udid...');

    let cmd,
        args = [];

    try {
      cmd = await _appiumSupport.fs.which('idevice_id');
      args.push('-l');
    } catch (err) {
      cmd = require.resolve('udidetect');
    }

    let udid;

    try {
      let {
        stdout
      } = await (0, _teen_process.exec)(cmd, args, {
        timeout: 3000
      });
      udid = stdout.split('\n')[0];
    } catch (err) {
      _logger.default.error('Error detecting udid');

      throw err;
    }

    if (udid && udid.length > 2) {
      caps.udid = udid;

      _logger.default.debug(`Detected udid as '${caps.udid}'`);
    } else {
      throw new Error('Could not detect udid.');
    }
  } else {
    _logger.default.debug('Not auto-detecting udid.');
  }
}

async function readResource(resourcePath) {
  const data = await _appiumSupport.plist.parsePlistFile(resourcePath);
  const result = {};

  for (const [key, value] of _lodash.default.toPairs(data)) {
    result[key] = _lodash.default.isString(value) ? value : JSON.stringify(value);
  }

  return result;
}

async function parseLocalizableStrings(opts) {
  const {
    app,
    language = 'en',
    localizableStringsDir,
    stringFile,
    strictMode
  } = opts;

  if (!app) {
    const message = "Strings extraction is not supported if 'app' capability is not set";

    if (strictMode) {
      throw new Error(message);
    }

    _logger.default.info(message);

    return {};
  }

  let lprojRoot;

  for (const subfolder of [`${language}.lproj`, localizableStringsDir, '']) {
    lprojRoot = _path.default.resolve(app, subfolder);

    if (await _appiumSupport.fs.exists(lprojRoot)) {
      break;
    }

    const message = `No '${lprojRoot}' resources folder has been found`;

    if (strictMode) {
      throw new Error(message);
    }

    _logger.default.debug(message);
  }

  _logger.default.info(`Will extract resource strings from '${lprojRoot}'`);

  const resourcePaths = [];

  if (stringFile) {
    const dstPath = _path.default.resolve(lprojRoot, stringFile);

    if (await _appiumSupport.fs.exists(dstPath)) {
      resourcePaths.push(dstPath);
    } else {
      const message = `No '${dstPath}' resource file has been found for '${app}'`;

      if (strictMode) {
        throw new Error(message);
      }

      _logger.default.info(message);

      _logger.default.info(`Getting all the available strings from '${lprojRoot}'`);
    }
  }

  if (_lodash.default.isEmpty(resourcePaths) && (await _appiumSupport.fs.exists(lprojRoot))) {
    const resourceFiles = (await _appiumSupport.fs.readdir(lprojRoot)).filter(name => _lodash.default.some([STRINGS_RESOURCE, STRINGSDICT_RESOURCE], x => name.endsWith(x))).map(name => _path.default.resolve(lprojRoot, name));
    resourcePaths.push(...resourceFiles);
  }

  _logger.default.info(`Got ${resourcePaths.length} resource file(s) in '${lprojRoot}'`);

  if (_lodash.default.isEmpty(resourcePaths)) {
    return {};
  }

  const resultStrings = {};

  const toAbsolutePath = function (p) {
    return _path.default.isAbsolute(p) ? p : _path.default.resolve(process.cwd(), p);
  };

  for (const resourcePath of resourcePaths) {
    if (!_appiumSupport.util.isSubPath(toAbsolutePath(resourcePath), toAbsolutePath(app))) {
      throw new Error(`'${resourcePath}' is expected to be located under '${app}'`);
    }

    try {
      const data = await readResource(resourcePath);

      _logger.default.debug(`Parsed ${_lodash.default.keys(data).length} string(s) from '${resourcePath}'`);

      _lodash.default.merge(resultStrings, data);
    } catch (e) {
      _logger.default.warn(`Cannot parse '${resourcePath}' resource. Original error: ${e.message}`);
    }
  }

  _logger.default.info(`Got ${_lodash.default.keys(resultStrings).length} string(s) from '${lprojRoot}'`);

  return resultStrings;
}

async function setBundleIdFromApp(caps) {
  if (!caps.bundleId) {
    try {
      caps.bundleId = await (0, _appUtils.extractBundleId)(caps.app);

      _logger.default.info(`Extracted bundleID: ${caps.bundleId} from app: ${caps.app}`);
    } catch (err) {
      _logger.default.error('Could not set the bundleId from app.');

      throw err;
    }
  }
}

function shouldPrelaunchSimulator(caps, iosSdkVersion) {
  let shouldPrelaunch = false;

  if (caps.defaultDevice || iosSdkVersion >= 7.1) {
    if (this.iosSdkVersion >= 7.1) {
      _logger.default.debug("We're on iOS7.1+ so forcing defaultDevice on");
    } else {
      _logger.default.debug('User specified default device, letting instruments launch it');
    }
  } else {
    shouldPrelaunch = true;
  }

  return shouldPrelaunch;
}

async function setDeviceTypeInInfoPlist(app, deviceString) {
  if (_lodash.default.isNull(app) || _lodash.default.isUndefined(app)) {
    return;
  }

  let plistFile = _path.default.resolve(app, 'Info.plist');

  let isiPhone = deviceString.toLowerCase().indexOf('ipad') === -1;
  let deviceTypeCode = isiPhone ? 1 : 2;
  await _appiumSupport.plist.updatePlistFile(plistFile, {
    UIDeviceFamily: [deviceTypeCode]
  });
}

function unwrapEl(el) {
  if (typeof el === 'object' && el.ELEMENT) {
    return el.ELEMENT;
  }

  return el;
}

async function clearLogs(locations) {
  _logger.default.debug('Clearing log files');

  for (let location of locations) {
    if (await _appiumSupport.fs.exists(location)) {
      let size;

      try {
        let {
          stdout
        } = await (0, _teen_process.exec)('du', ['-sh', location]);
        size = stdout.trim().split(/\s+/)[0];
      } catch (ign) {}

      try {
        _logger.default.debug(`Deleting '${location}'. ${size ? `Freeing ${size}.` : ''}`);

        await _appiumSupport.fs.rimraf(location);
      } catch (err) {
        _logger.default.warn(`Unable to delete '${location}': ${err.message}`);
      }
    }
  }

  _logger.default.debug('Finished clearing log files');
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi91dGlscy5qcyJdLCJuYW1lcyI6WyJyb290RGlyIiwicGF0aCIsInJlc29sdmUiLCJfX2Rpcm5hbWUiLCJTVFJJTkdTRElDVF9SRVNPVVJDRSIsIlNUUklOR1NfUkVTT1VSQ0UiLCJwcmVwYXJlSW9zT3B0cyIsIm9wdHMiLCJiYWNrZW5kUmV0cmllcyIsIndpdGhvdXREZWxheSIsIm5hdGl2ZUluc3RydW1lbnRzTGliIiwicmVzZXQiLCJub1Jlc2V0IiwiaW5pdGlhbE9yaWVudGF0aW9uIiwiZGV2aWNlT3JpZW50YXRpb24iLCJvcmllbnRhdGlvbiIsInVzZVJvYm90Iiwicm9ib3RQb3J0Iiwicm9ib3RVcmwiLCJyb2JvdEFkZHJlc3MiLCJsb2NhdGlvblNlcnZpY2VzQXV0aG9yaXplZCIsImJ1bmRsZUlkIiwiRXJyb3IiLCJwbGF0Zm9ybVZlcnNpb24iLCJ4Y29kZSIsImdldE1heElPU1NESyIsInB2IiwicGFyc2VGbG9hdCIsImxvZ2dlciIsIndhcm4iLCJsb2NhbGl6YWJsZVN0cmluZ3NEaXIiLCJhdXRvQWNjZXB0QWxlcnRzIiwiXyIsImlzTnVsbCIsImlzVW5kZWZpbmVkIiwiYXV0b0Rpc21pc3NBbGVydHMiLCJicm93c2VyTmFtZSIsInRvTG93ZXJDYXNlIiwiYXBwIiwiU0FGQVJJX0JVTkRMRSIsInVkaWQiLCJTQUZBUklfTEFVTkNIRVJfQVBQX0ZJTEUiLCJTQUZBUklfTEFVTkNIRVJfQlVORExFIiwic2FmYXJpIiwiYXBwSXNQYWNrYWdlT3JCdW5kbGUiLCJ0ZXN0IiwicmVtb3ZlSW5zdHJ1bWVudHNTb2NrZXQiLCJzb2NrIiwiZGVidWciLCJmcyIsInJpbXJhZiIsImdldEFuZENoZWNrWGNvZGVWZXJzaW9uIiwiY2FwcyIsInZlcnNpb24iLCJnZXRWZXJzaW9uIiwiZXJyIiwiZXJyb3IiLCJtZXNzYWdlIiwibWlub3JWZXJzaW9uIiwidmVyc2lvbkZsb2F0IiwidmVyc2lvblN0cmluZyIsImdldEFuZENoZWNrSW9zU2RrVmVyc2lvbiIsInZlcnNpb25OdW1iZXIiLCJnZXRTaW1Gb3JEZXZpY2VTdHJpbmciLCJkU3RyaW5nIiwiYXZhaWxEZXZpY2VzIiwibWF0Y2hlZERldmljZSIsIm1hdGNoZWRVZGlkIiwiZWFjaCIsImRldmljZSIsImluZGV4T2YiLCJleGVjIiwiZSIsImRldGVjdFVkaWQiLCJjbWQiLCJhcmdzIiwid2hpY2giLCJwdXNoIiwicmVxdWlyZSIsInN0ZG91dCIsInRpbWVvdXQiLCJzcGxpdCIsImxlbmd0aCIsInJlYWRSZXNvdXJjZSIsInJlc291cmNlUGF0aCIsImRhdGEiLCJwbGlzdCIsInBhcnNlUGxpc3RGaWxlIiwicmVzdWx0Iiwia2V5IiwidmFsdWUiLCJ0b1BhaXJzIiwiaXNTdHJpbmciLCJKU09OIiwic3RyaW5naWZ5IiwicGFyc2VMb2NhbGl6YWJsZVN0cmluZ3MiLCJsYW5ndWFnZSIsInN0cmluZ0ZpbGUiLCJzdHJpY3RNb2RlIiwiaW5mbyIsImxwcm9qUm9vdCIsInN1YmZvbGRlciIsImV4aXN0cyIsInJlc291cmNlUGF0aHMiLCJkc3RQYXRoIiwiaXNFbXB0eSIsInJlc291cmNlRmlsZXMiLCJyZWFkZGlyIiwiZmlsdGVyIiwibmFtZSIsInNvbWUiLCJ4IiwiZW5kc1dpdGgiLCJtYXAiLCJyZXN1bHRTdHJpbmdzIiwidG9BYnNvbHV0ZVBhdGgiLCJwIiwiaXNBYnNvbHV0ZSIsInByb2Nlc3MiLCJjd2QiLCJ1dGlsIiwiaXNTdWJQYXRoIiwia2V5cyIsIm1lcmdlIiwic2V0QnVuZGxlSWRGcm9tQXBwIiwic2hvdWxkUHJlbGF1bmNoU2ltdWxhdG9yIiwiaW9zU2RrVmVyc2lvbiIsInNob3VsZFByZWxhdW5jaCIsImRlZmF1bHREZXZpY2UiLCJzZXREZXZpY2VUeXBlSW5JbmZvUGxpc3QiLCJkZXZpY2VTdHJpbmciLCJwbGlzdEZpbGUiLCJpc2lQaG9uZSIsImRldmljZVR5cGVDb2RlIiwidXBkYXRlUGxpc3RGaWxlIiwiVUlEZXZpY2VGYW1pbHkiLCJ1bndyYXBFbCIsImVsIiwiRUxFTUVOVCIsImNsZWFy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dUMsUUFBVixDQUFWLEVBQStCO0FBQzdCLFVBQUlDLElBQUo7O0FBQ0EsVUFBSTtBQUNGLFlBQUk7QUFBQy9ELFVBQUFBO0FBQUQsWUFBVyxNQUFNLHdCQUFLLElBQUwsRUFBVyxDQUFDLEtBQUQsRUFBUThELFFBQVIsQ0FBWCxDQUFyQjtBQUNBQyxRQUFBQSxJQUFJLEdBQUcvRCxNQUFNLENBQUNnRSxJQUFQLEdBQWM5RCxLQUFkLENBQW9CLEtBQXBCLEVBQTJCLENBQTNCLENBQVA7QUFDRCxPQUhELENBR0UsT0FBTytELEdBQVAsRUFBWSxDQUFFOztBQUNoQixVQUFJO0FBQ0ZwSCx3QkFBT29CLEtBQVAsQ0FBYyxhQUFZNkYsUUFBUyxNQUFLQyxJQUFJLEdBQUksV0FBVUEsSUFBSyxHQUFuQixHQUF3QixFQUFHLEVBQXZFOztBQUNBLGNBQU03RixrQkFBR0MsTUFBSCxDQUFVMkYsUUFBVixDQUFOO0FBQ0QsT0FIRCxDQUdFLE9BQU90RixHQUFQLEVBQVk7QUFDWjNCLHdCQUFPQyxJQUFQLENBQWEscUJBQW9CZ0gsUUFBUyxNQUFLdEYsR0FBRyxDQUFDRSxPQUFRLEVBQTNEO0FBQ0Q7QUFDRjtBQUNGOztBQUNEN0Isa0JBQU9vQixLQUFQLENBQWEsNkJBQWI7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGZzLCBwbGlzdCwgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB4Y29kZSBmcm9tICdhcHBpdW0teGNvZGUnO1xuaW1wb3J0IHsgZXh0cmFjdEJ1bmRsZUlkIH0gZnJvbSAnLi9hcHAtdXRpbHMnO1xuaW1wb3J0IGxvZ2dlciBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB7IFNBRkFSSV9CVU5ETEUgfSBmcm9tICcuL2NvbW1hbmRzL3NhZmFyaSc7XG5pbXBvcnQgeyBTQUZBUklfTEFVTkNIRVJfQVBQX0ZJTEUsIFNBRkFSSV9MQVVOQ0hFUl9CVU5ETEUgfSBmcm9tICcuL3NhZmFyaS1sYXVuY2hlcic7XG5cblxuY29uc3Qgcm9vdERpciA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLicsICcuLicpO1xuY29uc3QgU1RSSU5HU0RJQ1RfUkVTT1VSQ0UgPSAnLnN0cmluZ3NkaWN0JztcbmNvbnN0IFNUUklOR1NfUkVTT1VSQ0UgPSAnLnN0cmluZ3MnO1xuXG5hc3luYyBmdW5jdGlvbiBwcmVwYXJlSW9zT3B0cyAob3B0cykge1xuICBvcHRzLmJhY2tlbmRSZXRyaWVzID0gNDtcbiAgb3B0cy53aXRob3V0RGVsYXkgPSAhb3B0cy5uYXRpdmVJbnN0cnVtZW50c0xpYjtcbiAgb3B0cy5yZXNldCA9ICFvcHRzLm5vUmVzZXQ7XG4gIG9wdHMuaW5pdGlhbE9yaWVudGF0aW9uID0gb3B0cy5kZXZpY2VPcmllbnRhdGlvbiB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdHMub3JpZW50YXRpb24gfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUE9SVFJBSVQnO1xuICBvcHRzLnVzZVJvYm90ID0gb3B0cy5yb2JvdFBvcnQgPiAwO1xuICBvcHRzLnJvYm90VXJsID0gb3B0cy51c2VSb2JvdCA/XG4gICAgYGh0dHA6Ly8ke29wdHMucm9ib3RBZGRyZXNzfToke29wdHMucm9ib3RQb3J0fWAgOiBudWxsO1xuICBpZiAob3B0cy5sb2NhdGlvblNlcnZpY2VzQXV0aG9yaXplZCAmJiAhb3B0cy5idW5kbGVJZCkge1xuICAgIHRocm93IG5ldyBFcnJvcignWW91IG11c3Qgc2V0IHRoZSBidW5kbGVJZCBjYXAgaWYgdXNpbmcgbG9jYXRpb25TZXJ2aWNlc0VuYWJsZWQnKTtcbiAgfVxuXG4gIG9wdHMucGxhdGZvcm1WZXJzaW9uID0gb3B0cy5wbGF0Zm9ybVZlcnNpb24gfHwgYXdhaXQgeGNvZGUuZ2V0TWF4SU9TU0RLKCk7XG4gIGxldCBwdiA9IHBhcnNlRmxvYXQob3B0cy5wbGF0Zm9ybVZlcnNpb24pO1xuICBpZiAocHYgPCA4KSB7XG4gICAgbG9nZ2VyLndhcm4oYGlPUyB2ZXJzaW9uICR7b3B0cy5wbGF0Zm9ybVZlcnNpb259IHN1cHBvcnQgaGFzIGJlZW4gYCArXG4gICAgICAgICAgICAgICAgYGRlcHJlY2F0ZWQgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiBhIGZ1dHVyZSB2ZXJzaW9uIG9mIGAgK1xuICAgICAgICAgICAgICAgIGBBcHBpdW0uYCk7XG4gIH1cbiAgb3B0cy5sb2NhbGl6YWJsZVN0cmluZ3NEaXIgPSBvcHRzLmxvY2FsaXphYmxlU3RyaW5nc0RpciB8fCAnZW4ubHByb2onO1xuICBvcHRzLmF1dG9BY2NlcHRBbGVydHMgPSBfLmlzTnVsbChvcHRzLmF1dG9BY2NlcHRBbGVydHMpIHx8IF8uaXNVbmRlZmluZWQob3B0cy5hdXRvQWNjZXB0QWxlcnRzKSA/IGZhbHNlIDogb3B0cy5hdXRvQWNjZXB0QWxlcnRzO1xuICBvcHRzLmF1dG9EaXNtaXNzQWxlcnRzID0gXy5pc051bGwob3B0cy5hdXRvRGlzbWlzc0FsZXJ0cykgfHwgXy5pc1VuZGVmaW5lZChvcHRzLmF1dG9EaXNtaXNzQWxlcnRzKSA/IGZhbHNlIDogb3B0cy5hdXRvRGlzbWlzc0FsZXJ0cztcblxuICBpZiAoKG9wdHMuYnJvd3Nlck5hbWUgfHwgJycpLnRvTG93ZXJDYXNlKCkgPT09ICdzYWZhcmknIHx8XG4gICAgICAob3B0cy5hcHAgfHwgJycpLnRvTG93ZXJDYXNlKCkgPT09ICdzYWZhcmknIHx8XG4gICAgICAob3B0cy5idW5kbGVJZCB8fCAnJykudG9Mb3dlckNhc2UoKSA9PT0gU0FGQVJJX0JVTkRMRSkge1xuICAgIC8vIHByZXBhcmluZyBhIHNhZmFyaSBzZXNzaW9uXG4gICAgaWYgKG9wdHMudWRpZCkge1xuICAgICAgLy8gb24gYSByZWFsIGRldmljZVxuICAgICAgb3B0cy5hcHAgPSBvcHRzLmFwcCB8fCBTQUZBUklfTEFVTkNIRVJfQVBQX0ZJTEU7XG4gICAgICBvcHRzLmJ1bmRsZUlkID0gb3B0cy5idW5kbGVJZCB8fCBTQUZBUklfTEFVTkNIRVJfQlVORExFO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAocGFyc2VGbG9hdChvcHRzLnBsYXRmb3JtVmVyc2lvbikgPD0gOCkge1xuICAgICAgICAvLyBtYWtlIHN1cmUgYXJncy5hcHAgaGFzIHNvbWV0aGluZyBpbiBpdCBzbyB3ZSBnZXQgdG8gdGhlIHJpZ2h0IHNwb3RzXG4gICAgICAgIC8vIGluIG1vdmVCdWlsdEluQXBwKClcbiAgICAgICAgb3B0cy5hcHAgPSAnc2FmYXJpJztcbiAgICAgICAgb3B0cy5idW5kbGVJZCA9IG51bGw7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvcHRzLmFwcCA9IG51bGw7XG4gICAgICAgIG9wdHMuYnVuZGxlSWQgPSBTQUZBUklfQlVORExFO1xuICAgICAgfVxuICAgIH1cbiAgICBvcHRzLnNhZmFyaSA9IHRydWU7XG4gIH1cbn1cblxuZnVuY3Rpb24gYXBwSXNQYWNrYWdlT3JCdW5kbGUgKGFwcCkge1xuICByZXR1cm4gKC9eKFthLXpBLVowLTlcXC1fXStcXC5bYS16QS1aMC05XFwtX10rKSskLykudGVzdChhcHApO1xufVxuXG5hc3luYyBmdW5jdGlvbiByZW1vdmVJbnN0cnVtZW50c1NvY2tldCAoc29jaykge1xuICBsb2dnZXIuZGVidWcoJ1JlbW92aW5nIGFueSByZW1haW5pbmcgaW5zdHJ1bWVudHMgc29ja2V0cycpO1xuICBhd2FpdCBmcy5yaW1yYWYoc29jayk7XG4gIGxvZ2dlci5kZWJ1ZyhgQ2xlYW5lZCB1cCBpbnN0cnVtZW50cyBzb2NrZXQgJHtzb2NrfWApO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbmRDaGVja1hjb2RlVmVyc2lvbiAoY2Fwcykge1xuICBsZXQgdmVyc2lvbjtcbiAgdHJ5IHtcbiAgICB2ZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0VmVyc2lvbih0cnVlKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nZ2VyLmRlYnVnKGVycik7XG4gICAgbG9nZ2VyLmVycm9yKGBDb3VsZCBub3QgZGV0ZXJtaW5lIFhjb2RlIHZlcnNpb246ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgdGhyb3cgZXJyO1xuICB9XG4gIGxldCBtaW5vclZlcnNpb24gPSB2ZXJzaW9uLnZlcnNpb25GbG9hdDtcbiAgbGV0IHB2ID0gcGFyc2VGbG9hdChjYXBzLnBsYXRmb3JtVmVyc2lvbik7XG4gIC8vIHdlIGRlcHJlY2F0ZSBYY29kZXMgPCA2LjMsIGV4Y2VwdCBmb3IgaU9TIDguMCBpbiB3aGljaCBjYXNlIHdlXG4gIC8vIHN1cHBvcnQgWGNvZGUgNi4wIGFzIHdlbGxcbiAgaWYgKG1pbm9yVmVyc2lvbiA8IDYuMyAmJiAoIShtaW5vclZlcnNpb24gPT09IDYuMCAmJiBwdiA9PT0gOC4wKSkpIHtcbiAgICBsb2dnZXIud2FybihgWGNvZGUgdmVyc2lvbiAnJHt2ZXJzaW9uLnZlcnNpb25TdHJpbmd9Jy4gU3VwcG9ydCBmb3IgWGNvZGUgYCArXG4gICAgICAgICAgICAgICAgYCR7dmVyc2lvbi52ZXJzaW9uU3RyaW5nfSBoYXMgYmVlbiBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgYCArXG4gICAgICAgICAgICAgICAgYGluIGEgZnV0dXJlIHZlcnNpb24uIFBsZWFzZSB1cGdyYWRlIHRvIHZlcnNpb24gNi4zIG9yIGAgK1xuICAgICAgICAgICAgICAgIGBoaWdoZXIgKG9yIHZlcnNpb24gNi4wLjEgZm9yIGlPUyA4LjApYCk7XG4gIH1cbiAgcmV0dXJuIHZlcnNpb247XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEFuZENoZWNrSW9zU2RrVmVyc2lvbiAoKSB7XG4gIGxldCB2ZXJzaW9uTnVtYmVyO1xuICB0cnkge1xuICAgIHZlcnNpb25OdW1iZXIgPSBhd2FpdCB4Y29kZS5nZXRNYXhJT1NTREsoKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nZ2VyLmVycm9yKCdDb3VsZCBub3QgZGV0ZXJtaW5lIGlPUyBTREsgdmVyc2lvbicpO1xuICAgIHRocm93IGVycjtcbiAgfVxuICByZXR1cm4gdmVyc2lvbk51bWJlcjtcbn1cblxuZnVuY3Rpb24gZ2V0U2ltRm9yRGV2aWNlU3RyaW5nIChkU3RyaW5nLCBhdmFpbERldmljZXMpIHtcbiAgbGV0IG1hdGNoZWREZXZpY2UgPSBudWxsO1xuICBsZXQgbWF0Y2hlZFVkaWQgPSBudWxsO1xuICBfLmVhY2goYXZhaWxEZXZpY2VzLCBmdW5jdGlvbiAoZGV2aWNlKSB7XG4gICAgaWYgKGRldmljZS5pbmRleE9mKGRTdHJpbmcpICE9PSAtMSkge1xuICAgICAgbWF0Y2hlZERldmljZSA9IGRldmljZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIG1hdGNoZWRVZGlkID0gLy4rXFxbKFteXFxdXSspXFxdLy5leGVjKGRldmljZSlbMV07XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIG1hdGNoZWRVZGlkID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuICByZXR1cm4gW21hdGNoZWREZXZpY2UsIG1hdGNoZWRVZGlkXTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZGV0ZWN0VWRpZCAoY2Fwcykge1xuICBpZiAoY2Fwcy51ZGlkICE9PSBudWxsICYmIGNhcHMudWRpZCA9PT0gJ2F1dG8nKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdBdXRvLWRldGVjdGluZyBpT1MgdWRpZC4uLicpO1xuICAgIGxldCBjbWQsIGFyZ3MgPSBbXTtcbiAgICB0cnkge1xuICAgICAgY21kID0gYXdhaXQgZnMud2hpY2goJ2lkZXZpY2VfaWQnKTtcbiAgICAgIGFyZ3MucHVzaCgnLWwnKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNtZCA9IHJlcXVpcmUucmVzb2x2ZSgndWRpZGV0ZWN0Jyk7XG4gICAgfVxuICAgIGxldCB1ZGlkO1xuICAgIHRyeSB7XG4gICAgICBsZXQge3N0ZG91dH0gPSBhd2FpdCBleGVjKGNtZCwgYXJncywge3RpbWVvdXQ6IDMwMDB9KTtcbiAgICAgIHVkaWQgPSBzdGRvdXQuc3BsaXQoJ1xcbicpWzBdO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBkZXRlY3RpbmcgdWRpZCcpO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICBpZiAodWRpZCAmJiB1ZGlkLmxlbmd0aCA+IDIpIHtcbiAgICAgIGNhcHMudWRpZCA9IHVkaWQ7XG4gICAgICBsb2dnZXIuZGVidWcoYERldGVjdGVkIHVkaWQgYXMgJyR7Y2Fwcy51ZGlkfSdgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDb3VsZCBub3QgZGV0ZWN0IHVkaWQuJyk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxvZ2dlci5kZWJ1ZygnTm90IGF1dG8tZGV0ZWN0aW5nIHVkaWQuJyk7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gcmVhZFJlc291cmNlIChyZXNvdXJjZVBhdGgpIHtcbiAgY29uc3QgZGF0YSA9IGF3YWl0IHBsaXN0LnBhcnNlUGxpc3RGaWxlKHJlc291cmNlUGF0aCk7XG4gIGNvbnN0IHJlc3VsdCA9IHt9O1xuICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBfLnRvUGFpcnMoZGF0YSkpIHtcbiAgICByZXN1bHRba2V5XSA9IF8uaXNTdHJpbmcodmFsdWUpID8gdmFsdWUgOiBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcGFyc2VMb2NhbGl6YWJsZVN0cmluZ3MgKG9wdHMpIHtcbiAgY29uc3Qge1xuICAgIGFwcCxcbiAgICBsYW5ndWFnZSA9ICdlbicsXG4gICAgbG9jYWxpemFibGVTdHJpbmdzRGlyLFxuICAgIHN0cmluZ0ZpbGUsXG4gICAgc3RyaWN0TW9kZSxcbiAgfSA9IG9wdHM7XG5cbiAgaWYgKCFhcHApIHtcbiAgICBjb25zdCBtZXNzYWdlID0gXCJTdHJpbmdzIGV4dHJhY3Rpb24gaXMgbm90IHN1cHBvcnRlZCBpZiAnYXBwJyBjYXBhYmlsaXR5IGlzIG5vdCBzZXRcIjtcbiAgICBpZiAoc3RyaWN0TW9kZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpO1xuICAgIH1cbiAgICBsb2dnZXIuaW5mbyhtZXNzYWdlKTtcbiAgICByZXR1cm4ge307XG4gIH1cblxuICBsZXQgbHByb2pSb290O1xuICBmb3IgKGNvbnN0IHN1YmZvbGRlciBvZiBbYCR7bGFuZ3VhZ2V9Lmxwcm9qYCwgbG9jYWxpemFibGVTdHJpbmdzRGlyLCAnJ10pIHtcbiAgICBscHJvalJvb3QgPSBwYXRoLnJlc29sdmUoYXBwLCBzdWJmb2xkZXIpO1xuICAgIGlmIChhd2FpdCBmcy5leGlzdHMobHByb2pSb290KSkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNvbnN0IG1lc3NhZ2UgPSBgTm8gJyR7bHByb2pSb290fScgcmVzb3VyY2VzIGZvbGRlciBoYXMgYmVlbiBmb3VuZGA7XG4gICAgaWYgKHN0cmljdE1vZGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgICB9XG4gICAgbG9nZ2VyLmRlYnVnKG1lc3NhZ2UpO1xuICB9XG4gIGxvZ2dlci5pbmZvKGBXaWxsIGV4dHJhY3QgcmVzb3VyY2Ugc3RyaW5ncyBmcm9tICcke2xwcm9qUm9vdH0nYCk7XG5cbiAgY29uc3QgcmVzb3VyY2VQYXRocyA9IFtdO1xuICBpZiAoc3RyaW5nRmlsZSkge1xuICAgIGNvbnN0IGRzdFBhdGggPSBwYXRoLnJlc29sdmUobHByb2pSb290LCBzdHJpbmdGaWxlKTtcbiAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKGRzdFBhdGgpKSB7XG4gICAgICByZXNvdXJjZVBhdGhzLnB1c2goZHN0UGF0aCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBgTm8gJyR7ZHN0UGF0aH0nIHJlc291cmNlIGZpbGUgaGFzIGJlZW4gZm91bmQgZm9yICcke2FwcH0nYDtcbiAgICAgIGlmIChzdHJpY3RNb2RlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgICAgIH1cbiAgICAgIGxvZ2dlci5pbmZvKG1lc3NhZ2UpO1xuICAgICAgbG9nZ2VyLmluZm8oYEdldHRpbmcgYWxsIHRoZSBhdmFpbGFibGUgc3RyaW5ncyBmcm9tICcke2xwcm9qUm9vdH0nYCk7XG4gICAgfVxuICB9XG5cbiAgaWYgKF8uaXNFbXB0eShyZXNvdXJjZVBhdGhzKSAmJiBhd2FpdCBmcy5leGlzdHMobHByb2pSb290KSkge1xuICAgIGNvbnN0IHJlc291cmNlRmlsZXMgPSAoYXdhaXQgZnMucmVhZGRpcihscHJvalJvb3QpKVxuICAgICAgLmZpbHRlcigobmFtZSkgPT4gXy5zb21lKFtTVFJJTkdTX1JFU09VUkNFLCBTVFJJTkdTRElDVF9SRVNPVVJDRV0sICh4KSA9PiBuYW1lLmVuZHNXaXRoKHgpKSlcbiAgICAgIC5tYXAoKG5hbWUpID0+IHBhdGgucmVzb2x2ZShscHJvalJvb3QsIG5hbWUpKTtcbiAgICByZXNvdXJjZVBhdGhzLnB1c2goLi4ucmVzb3VyY2VGaWxlcyk7XG4gIH1cbiAgbG9nZ2VyLmluZm8oYEdvdCAke3Jlc291cmNlUGF0aHMubGVuZ3RofSByZXNvdXJjZSBmaWxlKHMpIGluICcke2xwcm9qUm9vdH0nYCk7XG5cbiAgaWYgKF8uaXNFbXB0eShyZXNvdXJjZVBhdGhzKSkge1xuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIGNvbnN0IHJlc3VsdFN0cmluZ3MgPSB7fTtcbiAgY29uc3QgdG9BYnNvbHV0ZVBhdGggPSBmdW5jdGlvbiAocCkge1xuICAgIHJldHVybiBwYXRoLmlzQWJzb2x1dGUocCkgPyBwIDogcGF0aC5yZXNvbHZlKHByb2Nlc3MuY3dkKCksIHApO1xuICB9O1xuICBmb3IgKGNvbnN0IHJlc291cmNlUGF0aCBvZiByZXNvdXJjZVBhdGhzKSB7XG4gICAgaWYgKCF1dGlsLmlzU3ViUGF0aCh0b0Fic29sdXRlUGF0aChyZXNvdXJjZVBhdGgpLCB0b0Fic29sdXRlUGF0aChhcHApKSkge1xuICAgICAgLy8gc2VjdXJpdHkgcHJlY2F1dGlvblxuICAgICAgdGhyb3cgbmV3IEVycm9yKGAnJHtyZXNvdXJjZVBhdGh9JyBpcyBleHBlY3RlZCB0byBiZSBsb2NhdGVkIHVuZGVyICcke2FwcH0nYCk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVhZFJlc291cmNlKHJlc291cmNlUGF0aCk7XG4gICAgICBsb2dnZXIuZGVidWcoYFBhcnNlZCAke18ua2V5cyhkYXRhKS5sZW5ndGh9IHN0cmluZyhzKSBmcm9tICcke3Jlc291cmNlUGF0aH0nYCk7XG4gICAgICBfLm1lcmdlKHJlc3VsdFN0cmluZ3MsIGRhdGEpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZ2dlci53YXJuKGBDYW5ub3QgcGFyc2UgJyR7cmVzb3VyY2VQYXRofScgcmVzb3VyY2UuIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cblxuICBsb2dnZXIuaW5mbyhgR290ICR7Xy5rZXlzKHJlc3VsdFN0cmluZ3MpLmxlbmd0aH0gc3RyaW5nKHMpIGZyb20gJyR7bHByb2pSb290fSdgKTtcbiAgcmV0dXJuIHJlc3VsdFN0cmluZ3M7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNldEJ1bmRsZUlkRnJvbUFwcCAoY2Fwcykge1xuICAvLyBUaGlzIG1ldGhvZCB3aWxsIHRyeSB0byBleHRyYWN0IHRoZSBidW5kbGVJZCBmcm9tIHRoZSBhcHBcbiAgaWYgKCFjYXBzLmJ1bmRsZUlkKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNhcHMuYnVuZGxlSWQgPSBhd2FpdCBleHRyYWN0QnVuZGxlSWQoY2Fwcy5hcHApO1xuICAgICAgbG9nZ2VyLmluZm8oYEV4dHJhY3RlZCBidW5kbGVJRDogJHtjYXBzLmJ1bmRsZUlkfSBmcm9tIGFwcDogJHtjYXBzLmFwcH1gKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignQ291bGQgbm90IHNldCB0aGUgYnVuZGxlSWQgZnJvbSBhcHAuJyk7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHNob3VsZFByZWxhdW5jaFNpbXVsYXRvciAoY2FwcywgaW9zU2RrVmVyc2lvbikge1xuICBsZXQgc2hvdWxkUHJlbGF1bmNoID0gZmFsc2U7XG5cbiAgaWYgKGNhcHMuZGVmYXVsdERldmljZSB8fCBpb3NTZGtWZXJzaW9uID49IDcuMSkge1xuICAgIGlmICh0aGlzLmlvc1Nka1ZlcnNpb24gPj0gNy4xKSB7XG4gICAgICBsb2dnZXIuZGVidWcoXCJXZSdyZSBvbiBpT1M3LjErIHNvIGZvcmNpbmcgZGVmYXVsdERldmljZSBvblwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdVc2VyIHNwZWNpZmllZCBkZWZhdWx0IGRldmljZSwgbGV0dGluZyBpbnN0cnVtZW50cyBsYXVuY2ggaXQnKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgc2hvdWxkUHJlbGF1bmNoID0gdHJ1ZTtcbiAgfVxuICByZXR1cm4gc2hvdWxkUHJlbGF1bmNoO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZXREZXZpY2VUeXBlSW5JbmZvUGxpc3QgKGFwcCwgZGV2aWNlU3RyaW5nKSB7XG4gIGlmIChfLmlzTnVsbChhcHApIHx8IF8uaXNVbmRlZmluZWQoYXBwKSkgeyByZXR1cm47IH1cbiAgbGV0IHBsaXN0RmlsZSA9IHBhdGgucmVzb2x2ZShhcHAsICdJbmZvLnBsaXN0Jyk7XG4gIGxldCBpc2lQaG9uZSA9IGRldmljZVN0cmluZy50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ2lwYWQnKSA9PT0gLTE7XG4gIGxldCBkZXZpY2VUeXBlQ29kZSA9IGlzaVBob25lID8gMSA6IDI7XG4gIGF3YWl0IHBsaXN0LnVwZGF0ZVBsaXN0RmlsZShwbGlzdEZpbGUsIHtVSURldmljZUZhbWlseTogW2RldmljZVR5cGVDb2RlXX0pO1xufVxuXG5mdW5jdGlvbiB1bndyYXBFbCAoZWwpIHtcbiAgaWYgKHR5cGVvZiBlbCA9PT0gJ29iamVjdCcgJiYgZWwuRUxFTUVOVCkge1xuICAgIHJldHVybiBlbC5FTEVNRU5UO1xuICB9XG4gIHJldHVybiBlbDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gY2xlYXJMb2dzIChsb2NhdGlvbnMpIHtcbiAgbG9nZ2VyLmRlYnVnKCdDbGVhcmluZyBsb2cgZmlsZXMnKTtcbiAgZm9yIChsZXQgbG9jYXRpb24gb2YgbG9jYXRpb25zKSB7XG4gICAgaWYgKGF3YWl0IGZzLmV4aXN0cyhsb2NhdGlvbikpIHtcbiAgICAgIGxldCBzaXplO1xuICAgICAgdHJ5IHtcbiAgICAgICAgbGV0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygnZHUnLCBbJy1zaCcsIGxvY2F0aW9uXSk7XG4gICAgICAgIHNpemUgPSBzdGRvdXQudHJpbSgpLnNwbGl0KC9cXHMrLylbMF07XG4gICAgICB9IGNhdGNoIChpZ24pIHt9XG4gICAgICB0cnkge1xuICAgICAgICBsb2dnZXIuZGVidWcoYERlbGV0aW5nICcke2xvY2F0aW9ufScuICR7c2l6ZSA/IGBGcmVlaW5nICR7c2l6ZX0uYCA6ICcnfWApO1xuICAgICAgICBhd2FpdCBmcy5yaW1yYWYobG9jYXRpb24pO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxvZ2dlci53YXJuKGBVbmFibGUgdG8gZGVsZXRlICcke2xvY2F0aW9ufSc6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGxvZ2dlci5kZWJ1ZygnRmluaXNoZWQgY2xlYXJpbmcgbG9nIGZpbGVzJyk7XG59XG5cbmV4cG9ydCB7XG4gIHJvb3REaXIsIHJlbW92ZUluc3RydW1lbnRzU29ja2V0LCBnZXRBbmRDaGVja1hjb2RlVmVyc2lvbiwgcHJlcGFyZUlvc09wdHMsXG4gIGFwcElzUGFja2FnZU9yQnVuZGxlLCBnZXRBbmRDaGVja0lvc1Nka1ZlcnNpb24sIGRldGVjdFVkaWQsIHBhcnNlTG9jYWxpemFibGVTdHJpbmdzLFxuICBzZXRCdW5kbGVJZEZyb21BcHAsIHNob3VsZFByZWxhdW5jaFNpbXVsYXRvciwgc2V0RGV2aWNlVHlwZUluSW5mb1BsaXN0LFxuICBnZXRTaW1Gb3JEZXZpY2VTdHJpbmcsIHVud3JhcEVsLCBjbGVhckxvZ3MsXG59O1xuIl0sImZpbGUiOiJsaWIvdXRpbHMuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==

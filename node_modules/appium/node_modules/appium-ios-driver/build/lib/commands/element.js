"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = exports.commands = void 0;

require("source-map-support/register");

var _appiumBaseDriver = require("appium-base-driver");

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumSupport = require("appium-support");

var _utils = require("../utils");

let commands = {},
    helpers = {},
    extensions = {};
exports.helpers = helpers;
exports.commands = commands;

commands.getAttribute = async function (attribute, el) {
  el = (0, _utils.unwrapEl)(el);

  if (this.isWebContext()) {
    let atomsElement = this.getAtomsElement(el);

    if (_lodash.default.isNull(atomsElement)) {
      throw new _appiumBaseDriver.errors.UnknownError(`Error converting element ID for using in WD atoms: '${el}'`);
    } else {
      return await this.executeAtom('get_attribute_value', [atomsElement, attribute]);
    }
  } else {
    if (attribute === 'contentSize') {
      return await this.getElementContentSize(el);
    }

    if (_lodash.default.includes(['label', 'name', 'value', 'values', 'hint'], attribute)) {
      let command = `au.getElement('${el}').${attribute}()`;
      return await this.uiAutoClient.sendCommand(command);
    } else {
      throw new _appiumBaseDriver.errors.UnknownCommandError(`UIAElements don't have the attribute '${attribute}'`);
    }
  }
};

commands.clear = async function (el) {
  el = (0, _utils.unwrapEl)(el);

  if (this.isWebContext()) {
    let atomsElement = this.useAtomsElement(el);
    await this.executeAtom('clear', [atomsElement]);
  } else {
    let command = `au.getElement('${el}').setValue('')`;
    await this.uiAutoClient.sendCommand(command);
  }
};

commands.setValueImmediate = async function (value, el) {
  el = (0, _utils.unwrapEl)(el);
  value = _appiumSupport.util.escapeSpecialChars(value, "'");
  let command = `au.getElement('${el}').setValue('${value}')`;
  await this.uiAutoClient.sendCommand(command);
};

commands.setValue = async function (value, el) {
  el = (0, _utils.unwrapEl)(el);

  if (this.isWebContext()) {
    let atomsElement = this.useAtomsElement(el);
    await this.executeAtom('click', [atomsElement]);
    await this.executeAtom('type', [atomsElement, value]);
  } else {
    if (value instanceof Array) {
      value = value.join('');
    }

    if (typeof value !== 'string') {
      value = value.toString();
    }

    value = _appiumSupport.util.escapeSpecialChars(value, "'");
    value = value.replace(/\\\\n/g, '\\n');

    if (this.opts.useRobot) {
      throw new _appiumBaseDriver.errors.NotYetImplementedError();
    } else {
      let command = `au.getElement('${el}').setValueByType('${value}')`;
      await this.uiAutoClient.sendCommand(command);
    }
  }
};

commands.getText = async function (el) {
  el = (0, _utils.unwrapEl)(el);

  if (this.isWebContext()) {
    let atomsElement = this.useAtomsElement(el);
    return await this.executeAtom('get_text', [atomsElement]);
  } else {
    let command = `au.getElement('${el}').text()`;
    let res = await this.uiAutoClient.sendCommand(command);
    res = res ? res.toString() : '';
    return res;
  }
};

commands.elementDisplayed = async function (el) {
  el = (0, _utils.unwrapEl)(el);

  if (this.isWebContext()) {
    let atomsElement = this.useAtomsElement(el);
    return await this.executeAtom('is_displayed', [atomsElement]);
  } else {
    let command = `au.getElement('${el}').isDisplayed()`;
    return await this.uiAutoClient.sendCommand(command);
  }
};

commands.elementEnabled = async function (el) {
  el = (0, _utils.unwrapEl)(el);

  if (this.isWebContext()) {
    let atomsElement = this.useAtomsElement(el);
    return await this.executeAtom('is_enabled', [atomsElement]);
  } else {
    let command = `au.getElement('${el}').isEnabled() === 1`;
    return await this.uiAutoClient.sendCommand(command);
  }
};

commands.elementSelected = async function (el) {
  el = (0, _utils.unwrapEl)(el);

  if (this.isWebContext()) {
    let atomsElement = this.useAtomsElement(el);
    return await this.executeAtom('is_selected', [atomsElement]);
  } else {
    let command = `au.getElement('${el}').isSelected()`;
    return await this.uiAutoClient.sendCommand(command);
  }
};

commands.getName = async function (el) {
  el = (0, _utils.unwrapEl)(el);

  if (this.isWebContext()) {
    let atomsElement = this.useAtomsElement(el);
    let script = 'return arguments[0].tagName.toLowerCase()';
    return await this.executeAtom('execute_script', [script, [atomsElement]]);
  } else {
    let command = `au.getElement('${el}').type()`;
    return await this.uiAutoClient.sendCommand(command);
  }
};

commands.getLocation = async function (el) {
  el = (0, _utils.unwrapEl)(el);

  if (this.isWebContext()) {
    let atomsElement = await this.useAtomsElement(el);
    return await this.executeAtom('get_top_left_coordinates', [atomsElement]);
  } else {
    let command = `au.getElement('${el}').getElementLocation()`;
    return await this.uiAutoClient.sendCommand(command);
  }
};

commands.getLocationInView = async function (el) {
  return await this.getLocation(el);
};

commands.getSize = async function (el) {
  el = (0, _utils.unwrapEl)(el);

  if (this.isWebContext()) {
    let atomsElement = this.getAtomsElement(el);

    if (atomsElement === null) {
      throw new _appiumBaseDriver.errors.UnknownError(`Error converting element ID for using in WD atoms: '${el}'`);
    } else {
      return await this.executeAtom('get_size', [atomsElement]);
    }
  } else {
    let command = `au.getElement('${el}').getElementSize()`;
    return await this.uiAutoClient.sendCommand(command);
  }
};

commands.getElementContentSize = async function (el) {
  el = (0, _utils.unwrapEl)(el);
  const command = `au.getElement('${el}').childElementsFrames()`;
  const frames = await this.uiAutoClient.sendCommand(command);
  const type = await this.getName(el);
  let contentHeight = 0;

  switch (type) {
    case 'UIATableView':
      {
        const firstElementFrame = _lodash.default.first(frames);

        const lastElementFrame = _lodash.default.last(frames);

        contentHeight = lastElementFrame.origin.y + lastElementFrame.size.height - firstElementFrame.origin.y;
        break;
      }

    case 'UIACollectionView':
      {
        let firstElementFrame = _lodash.default.first(frames);

        let elementsInRow = 0;

        for (const [i, frame] of frames.entries()) {
          if (frame.origin.y !== firstElementFrame.origin.y) {
            elementsInRow = i;
            break;
          }
        }

        const spaceBetweenElements = frames[elementsInRow].origin.y - frames[elementsInRow - 1].origin.y - frames[elementsInRow - 1].size.height;
        const numberOfRows = Math.ceil(frames.length / elementsInRow);
        contentHeight = numberOfRows * firstElementFrame.size.height + spaceBetweenElements * (numberOfRows - 1);
        break;
      }

    default:
      {
        return null;
      }
  }

  const size = await this.getSize(el);
  const topLeftCoord = await this.getLocationInView(el);
  return JSON.stringify({
    width: size.width,
    height: size.height,
    top: topLeftCoord.y,
    left: topLeftCoord.x,
    scrollableOffset: contentHeight
  });
};

Object.assign(extensions, commands, helpers);
var _default = extensions;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIl0sIm5hbWVzIjpbImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJnZXRBdHRyaWJ1dGUiLCJhdHRyaWJ1dGUiLCJlbCIsImlzV2ViQ29udGV4dCIsImF0b21zRWxlbWVudCIsImdldEF0b21zRWxlbWVudCIsIl8iLCJpc051bGwiLCJlcnJvcnMiLCJVbmtub3duRXJyb3IiLCJleGVjdXRlQXRvbSIsImdldEVsZW1lbnRDb250ZW50U2l6ZSIsImluY2x1ZGVzIiwiY29tbWFuZCIsInVpQXV0b0NsaWVudCIsInNlbmRDb21tYW5kIiwiVW5rbm93bkNvbW1hbmRFcnJvciIsImNsZWFyIiwidXNlQXRvbXNFbGVtZW50Iiwic2V0VmFsdWVJbW1lZGlhdGUiLCJ2YWx1ZSIsInV0aWwiLCJlc2NhcGVTcGVjaWFsQ2hhcnMiLCJzZXRWYWx1ZSIsIkFycmF5Iiwiam9pbiIsInRvU3RyaW5nIiwicmVwbGFjZSIsIm9wdHMiLCJ1c2VSb2JvdCIsIk5vdFlldEltcGxlbWVudGVkRXJyb3IiLCJnZXRUZXh0IiwicmVzIiwiZWxlbWVudERpc3BsYXllZCIsImVsZW1lbnRFbmFibGVkIiwiZWxlbWVudFNlbGVjdGVkIiwiZ2V0TmFtZSIsInNjcmlwdCIsImdldExvY2F0aW9uIiwiZ2V0TG9jYXRpb25JblZpZXciLCJnZXRTaXplIiwiZnJhbWVzIiwidHlwZSIsImNvbnRlbnRIZWlnaHQiLCJmaXJzdEVsZW1lbnRGcmFtZSIsImZpcnN0IiwibGFzdEVsZW1lbnRGcmFtZSIsImxhc3QiLCJvcmlnaW4iLCJ5Iiwic2l6ZSIsImhlaWdodCIsImVsZW1lbnRzSW5Sb3ciLCJpIiwiZnJhbWUiLCJlbnRyaWVzIiwic3BhY2VCZXR3ZWVuRWxlbWVudHMiLCJudW1iZXJPZlJvd3MiLCJNYXRoIiwiY2VpbCIsImxlbmd0aCIsInRvcExlZnRDb29yZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJ3aWR0aCIsInRvcCIsImxlZnQiLCJ4Iiwi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QVAsQ0FBY3ZFLFVBQWQsRUFBMEJGLFFBQTFCLEVBQW9DQyxPQUFwQztlQUVlQyxVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyB1dGlsIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHsgdW53cmFwRWwgfSBmcm9tICcuLi91dGlscyc7XG5cbmxldCBjb21tYW5kcyA9IHt9LCBoZWxwZXJzID0ge30sIGV4dGVuc2lvbnMgPSB7fTtcblxuY29tbWFuZHMuZ2V0QXR0cmlidXRlID0gYXN5bmMgZnVuY3Rpb24gKGF0dHJpYnV0ZSwgZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMuZ2V0QXRvbXNFbGVtZW50KGVsKTtcbiAgICBpZiAoXy5pc051bGwoYXRvbXNFbGVtZW50KSkge1xuICAgICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IoYEVycm9yIGNvbnZlcnRpbmcgZWxlbWVudCBJRCBmb3IgdXNpbmcgaW4gV0QgYXRvbXM6ICcke2VsfSdgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2dldF9hdHRyaWJ1dGVfdmFsdWUnLCBbYXRvbXNFbGVtZW50LCBhdHRyaWJ1dGVdKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgaWYgKGF0dHJpYnV0ZSA9PT0gJ2NvbnRlbnRTaXplJykge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0RWxlbWVudENvbnRlbnRTaXplKGVsKTtcbiAgICB9XG4gICAgaWYgKF8uaW5jbHVkZXMoWydsYWJlbCcsICduYW1lJywgJ3ZhbHVlJywgJ3ZhbHVlcycsICdoaW50J10sIGF0dHJpYnV0ZSkpIHtcbiAgICAgIGxldCBjb21tYW5kID0gYGF1LmdldEVsZW1lbnQoJyR7ZWx9JykuJHthdHRyaWJ1dGV9KClgO1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKGNvbW1hbmQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25Db21tYW5kRXJyb3IoYFVJQUVsZW1lbnRzIGRvbid0IGhhdmUgdGhlIGF0dHJpYnV0ZSAnJHthdHRyaWJ1dGV9J2ApO1xuICAgIH1cbiAgfVxufTtcblxuY29tbWFuZHMuY2xlYXIgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdjbGVhcicsIFthdG9tc0VsZW1lbnRdKTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgY29tbWFuZCA9IGBhdS5nZXRFbGVtZW50KCcke2VsfScpLnNldFZhbHVlKCcnKWA7XG4gICAgYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoY29tbWFuZCk7XG4gIH1cbn07XG5cbmNvbW1hbmRzLnNldFZhbHVlSW1tZWRpYXRlID0gYXN5bmMgZnVuY3Rpb24gKHZhbHVlLCBlbCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcbiAgdmFsdWUgPSB1dGlsLmVzY2FwZVNwZWNpYWxDaGFycyh2YWx1ZSwgXCInXCIpO1xuICBsZXQgY29tbWFuZCA9IGBhdS5nZXRFbGVtZW50KCcke2VsfScpLnNldFZhbHVlKCcke3ZhbHVlfScpYDtcbiAgYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoY29tbWFuZCk7XG59O1xuXG5jb21tYW5kcy5zZXRWYWx1ZSA9IGFzeW5jIGZ1bmN0aW9uICh2YWx1ZSwgZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdjbGljaycsIFthdG9tc0VsZW1lbnRdKTtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCd0eXBlJywgW2F0b21zRWxlbWVudCwgdmFsdWVdKTtcbiAgfSBlbHNlIHtcbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgdmFsdWUgPSB2YWx1ZS5qb2luKCcnKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHZhbHVlID0gdmFsdWUudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgdmFsdWUgPSB1dGlsLmVzY2FwZVNwZWNpYWxDaGFycyh2YWx1ZSwgXCInXCIpO1xuICAgIC8vIGRlLWVzY2FwZSBcXG4gc28gaXQgY2FuIGJlIHVzZWQgc3BlY2lhbGx5XG4gICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9cXFxcXFxcXG4vZywgJ1xcXFxuJyk7XG4gICAgaWYgKHRoaXMub3B0cy51c2VSb2JvdCkge1xuICAgICAgLyogVE9ETyAqL3Rocm93IG5ldyBlcnJvcnMuTm90WWV0SW1wbGVtZW50ZWRFcnJvcigpO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgY29tbWFuZCA9IGBhdS5nZXRFbGVtZW50KCcke2VsfScpLnNldFZhbHVlQnlUeXBlKCcke3ZhbHVlfScpYDtcbiAgICAgIGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKGNvbW1hbmQpO1xuICAgIH1cbiAgfVxufTtcblxuY29tbWFuZHMuZ2V0VGV4dCA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcbiAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICBsZXQgYXRvbXNFbGVtZW50ID0gdGhpcy51c2VBdG9tc0VsZW1lbnQoZWwpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdnZXRfdGV4dCcsIFthdG9tc0VsZW1lbnRdKTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgY29tbWFuZCA9IGBhdS5nZXRFbGVtZW50KCcke2VsfScpLnRleHQoKWA7XG4gICAgbGV0IHJlcyA9IGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKGNvbW1hbmQpO1xuICAgIC8vIGluIHNvbWUgY2FzZXMgaW5zdHJ1bWVudHMgcmV0dXJucyBpbiBpbnRlZ2VyLiB3ZSBvbmx5IHdhbnQgYSBzdHJpbmdcbiAgICByZXMgPSByZXMgPyByZXMudG9TdHJpbmcoKSA6ICcnO1xuICAgIHJldHVybiByZXM7XG4gIH1cbn07XG5cbmNvbW1hbmRzLmVsZW1lbnREaXNwbGF5ZWQgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnaXNfZGlzcGxheWVkJywgW2F0b21zRWxlbWVudF0pO1xuICB9IGVsc2Uge1xuICAgIGxldCBjb21tYW5kID0gYGF1LmdldEVsZW1lbnQoJyR7ZWx9JykuaXNEaXNwbGF5ZWQoKWA7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKGNvbW1hbmQpO1xuICB9XG59O1xuXG5jb21tYW5kcy5lbGVtZW50RW5hYmxlZCA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcbiAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICBsZXQgYXRvbXNFbGVtZW50ID0gdGhpcy51c2VBdG9tc0VsZW1lbnQoZWwpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdpc19lbmFibGVkJywgW2F0b21zRWxlbWVudF0pO1xuICB9IGVsc2Uge1xuICAgIGxldCBjb21tYW5kID0gYGF1LmdldEVsZW1lbnQoJyR7ZWx9JykuaXNFbmFibGVkKCkgPT09IDFgO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChjb21tYW5kKTtcbiAgfVxufTtcblxuY29tbWFuZHMuZWxlbWVudFNlbGVjdGVkID0gYXN5bmMgZnVuY3Rpb24gKGVsKSB7XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGxldCBhdG9tc0VsZW1lbnQgPSB0aGlzLnVzZUF0b21zRWxlbWVudChlbCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2lzX3NlbGVjdGVkJywgW2F0b21zRWxlbWVudF0pO1xuICB9IGVsc2Uge1xuICAgIGxldCBjb21tYW5kID0gYGF1LmdldEVsZW1lbnQoJyR7ZWx9JykuaXNTZWxlY3RlZCgpYDtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoY29tbWFuZCk7XG4gIH1cbn07XG5cbmNvbW1hbmRzLmdldE5hbWUgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcbiAgICBsZXQgc2NyaXB0ID0gJ3JldHVybiBhcmd1bWVudHNbMF0udGFnTmFtZS50b0xvd2VyQ2FzZSgpJztcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnZXhlY3V0ZV9zY3JpcHQnLCBbc2NyaXB0LCBbYXRvbXNFbGVtZW50XV0pO1xuICB9IGVsc2Uge1xuICAgIGxldCBjb21tYW5kID0gYGF1LmdldEVsZW1lbnQoJyR7ZWx9JykudHlwZSgpYDtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoY29tbWFuZCk7XG4gIH1cbn07XG5cbmNvbW1hbmRzLmdldExvY2F0aW9uID0gYXN5bmMgZnVuY3Rpb24gKGVsKSB7XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGxldCBhdG9tc0VsZW1lbnQgPSBhd2FpdCB0aGlzLnVzZUF0b21zRWxlbWVudChlbCk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuZXhlY3V0ZUF0b20oJ2dldF90b3BfbGVmdF9jb29yZGluYXRlcycsIFthdG9tc0VsZW1lbnRdKTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgY29tbWFuZCA9IGBhdS5nZXRFbGVtZW50KCcke2VsfScpLmdldEVsZW1lbnRMb2NhdGlvbigpYDtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoY29tbWFuZCk7XG4gIH1cbn07XG5cbmNvbW1hbmRzLmdldExvY2F0aW9uSW5WaWV3ID0gYXN5bmMgZnVuY3Rpb24gKGVsKSB7XG4gIHJldHVybiBhd2FpdCB0aGlzLmdldExvY2F0aW9uKGVsKTtcbn07XG5cbmNvbW1hbmRzLmdldFNpemUgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMuZ2V0QXRvbXNFbGVtZW50KGVsKTtcbiAgICBpZiAoYXRvbXNFbGVtZW50ID09PSBudWxsKSB7XG4gICAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25FcnJvcihgRXJyb3IgY29udmVydGluZyBlbGVtZW50IElEIGZvciB1c2luZyBpbiBXRCBhdG9tczogJyR7ZWx9J2ApO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnZ2V0X3NpemUnLCBbYXRvbXNFbGVtZW50XSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxldCBjb21tYW5kID0gYGF1LmdldEVsZW1lbnQoJyR7ZWx9JykuZ2V0RWxlbWVudFNpemUoKWA7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKGNvbW1hbmQpO1xuICB9XG59O1xuXG5jb21tYW5kcy5nZXRFbGVtZW50Q29udGVudFNpemUgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG4gIGNvbnN0IGNvbW1hbmQgPSBgYXUuZ2V0RWxlbWVudCgnJHtlbH0nKS5jaGlsZEVsZW1lbnRzRnJhbWVzKClgO1xuICBjb25zdCBmcmFtZXMgPSBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChjb21tYW5kKTtcbiAgY29uc3QgdHlwZSA9IGF3YWl0IHRoaXMuZ2V0TmFtZShlbCk7XG5cbiAgbGV0IGNvbnRlbnRIZWlnaHQgPSAwO1xuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlICdVSUFUYWJsZVZpZXcnOiB7XG4gICAgICBjb25zdCBmaXJzdEVsZW1lbnRGcmFtZSA9IF8uZmlyc3QoZnJhbWVzKTtcbiAgICAgIGNvbnN0IGxhc3RFbGVtZW50RnJhbWUgPSBfLmxhc3QoZnJhbWVzKTtcbiAgICAgIGNvbnRlbnRIZWlnaHQgPSBsYXN0RWxlbWVudEZyYW1lLm9yaWdpbi55ICsgbGFzdEVsZW1lbnRGcmFtZS5zaXplLmhlaWdodCAtIGZpcnN0RWxlbWVudEZyYW1lLm9yaWdpbi55O1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgJ1VJQUNvbGxlY3Rpb25WaWV3Jzoge1xuICAgICAgbGV0IGZpcnN0RWxlbWVudEZyYW1lID0gXy5maXJzdChmcmFtZXMpO1xuICAgICAgbGV0IGVsZW1lbnRzSW5Sb3cgPSAwO1xuXG4gICAgICAvLyBHZXQgbnVtYmVyIG9mIGVsZW1lbnRzIGluIGEgcm93XG4gICAgICBmb3IgKGNvbnN0IFtpLCBmcmFtZV0gb2YgZnJhbWVzLmVudHJpZXMoKSkge1xuICAgICAgICBpZiAoZnJhbWUub3JpZ2luLnkgIT09IGZpcnN0RWxlbWVudEZyYW1lLm9yaWdpbi55KSB7XG4gICAgICAgICAgZWxlbWVudHNJblJvdyA9IGk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3BhY2VCZXR3ZWVuRWxlbWVudHMgPSBmcmFtZXNbZWxlbWVudHNJblJvd10ub3JpZ2luLnkgLSBmcmFtZXNbZWxlbWVudHNJblJvdyAtIDFdLm9yaWdpbi55IC0gZnJhbWVzW2VsZW1lbnRzSW5Sb3cgLSAxXS5zaXplLmhlaWdodDtcbiAgICAgIGNvbnN0IG51bWJlck9mUm93cyA9IE1hdGguY2VpbChmcmFtZXMubGVuZ3RoIC8gZWxlbWVudHNJblJvdyk7XG5cbiAgICAgIC8vIEFzc3VtZSB0aGF0IGFsbCBjZWxscyBhcmUgb2YgdGhlIHNhbWUgc2l6ZVxuICAgICAgY29udGVudEhlaWdodCA9IG51bWJlck9mUm93cyAqIGZpcnN0RWxlbWVudEZyYW1lLnNpemUuaGVpZ2h0ICsgc3BhY2VCZXR3ZWVuRWxlbWVudHMgKiAobnVtYmVyT2ZSb3dzIC0gMSk7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgLy8gVGhpcyBtZXRob2QgY2FsY3VsYXRlcyBjb250ZW50IHNpemUgb25seSBmb3IgVUlBVGFibGVWaWV3IGFuZCBVSUFDb2xsZWN0aW9uVmlldy4gVUlBV2ViVmlldyBpcyBjb21taW5nIHNvb24uXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBjb25zdCBzaXplID0gYXdhaXQgdGhpcy5nZXRTaXplKGVsKTtcbiAgY29uc3QgdG9wTGVmdENvb3JkID0gYXdhaXQgdGhpcy5nZXRMb2NhdGlvbkluVmlldyhlbCk7XG5cbiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHtcbiAgICB3aWR0aDogc2l6ZS53aWR0aCxcbiAgICBoZWlnaHQ6IHNpemUuaGVpZ2h0LFxuICAgIHRvcDogdG9wTGVmdENvb3JkLnksXG4gICAgbGVmdDogdG9wTGVmdENvb3JkLngsXG4gICAgc2Nyb2xsYWJsZU9mZnNldDogY29udGVudEhlaWdodFxuICB9KTtcbn07XG5cbk9iamVjdC5hc3NpZ24oZXh0ZW5zaW9ucywgY29tbWFuZHMsIGhlbHBlcnMpO1xuZXhwb3J0IHsgY29tbWFuZHMsIGhlbHBlcnMgfTtcbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4iXSwiZmlsZSI6ImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
